<Window
  x:Class="LinkerPlayer.Windows.PropertiesWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:local="clr-namespace:LinkerPlayer.Windows"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  Title="PropertiesWindow"
  Width="500"
  Height="800"
  WindowStyle="None"
  mc:Ignorable="d">

  <WindowChrome.WindowChrome>
    <WindowChrome CaptionHeight="25" />
  </WindowChrome.WindowChrome>

  <Window.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/LinkerPlayer;component/Styles/StylesRepository.xaml" />
      </ResourceDictionary.MergedDictionaries>

      <!--  Inverse Boolean Converter  -->
      <BooleanToVisibilityConverter x:Key="BoolToVisConverter" />
      <local:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </ResourceDictionary>
  </Window.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="45" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <Grid.Background>
      <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
        <GradientStop Color="{DynamicResource MainWindowGradientStartColor}" />
        <GradientStop Offset=".1" Color="{DynamicResource MainWindowGradientStartColor}" />
        <GradientStop Offset="1" Color="{DynamicResource MainWindowGradientStartColor}" />
      </LinearGradientBrush>
    </Grid.Background>

    <Grid Grid.Row="0">
      <TextBlock
        Margin="12,2,0,0"
        HorizontalAlignment="Left"
        VerticalAlignment="Top"
        d:Foreground=" White"
        FontSize="{DynamicResource FontSizeTitle}"
        FontWeight="Light"
        Foreground="{DynamicResource TitleBarForegroundBrush}"
        Text="Properties" />

      <StackPanel
        HorizontalAlignment="Right"
        VerticalAlignment="Top"
        Background="{DynamicResource TitleBarBackgroundBrush}"
        Orientation="Horizontal"
        WindowChrome.IsHitTestVisibleInChrome="True">

        <Button
          Name="CloseButton"
          Background="{DynamicResource TitleBarBackgroundBrush}"
          Click="CloseButton_Click"
          Content="{iconPacks:Material Close,
                                       Width=14,
                                       Height=14}"
          Style="{DynamicResource CloseButton}" />

      </StackPanel>
    </Grid>
    <Grid Grid.Row="1">
      <DockPanel>
        <StackPanel
          Margin="10,10,10,10"
          HorizontalAlignment="Right"
          DockPanel.Dock="Bottom"
          Orientation="Horizontal">
          <Button
            Width="75"
            Margin="0,0,5,0"
            Command="{Binding OkCommand}"
            Content="OK" />
          <Button
            Width="75"
            Margin="0,0,5,0"
            Command="{Binding ApplyCommand}"
            Content="Apply"
            IsEnabled="{Binding HasUnsavedChanges}" />
          <Button
            Width="75"
            Command="{Binding CancelCommand}"
            Content="Cancel" />
        </StackPanel>
        <ScrollViewer
          x:Name="WindowScrollViewer"
          HorizontalScrollBarVisibility="Disabled"
          VerticalScrollBarVisibility="Auto">
          <ScrollViewer.Resources>
            <Style BasedOn="{StaticResource CustomScrollBarStyle}" TargetType="ScrollBar" />
          </ScrollViewer.Resources>
          <Grid Margin="10">
            <Grid.RowDefinitions>
              <!--  Metadata  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <!--  Comment  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <!--  Properties  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <!--  ReplayGain  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <!--  Picture  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <!--  Lyrics  -->
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  Metadata Title with Bar  -->
            <Grid Grid.Row="0" Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource ControlAccentLightBrush}"
                Text="Metadata" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource ControlAccentLightBrush}" />
            </Grid>

            <DataGrid
              Grid.Row="1"
              Height="Auto"
              MinWidth="400"
              MaxHeight="Infinity"
              Margin="0,0,0,4"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              CanUserResizeRows="False"
              CellStyle="{StaticResource SharedDataGridCellStyle}"
              ColumnHeaderStyle="{StaticResource SharedDataGridColumnHeaderStyle}"
              HorizontalScrollBarVisibility="Disabled"
              ItemsSource="{Binding MetadataItems}"
              PreviewMouseWheel="DataGrid_PreviewMouseWheel"
              RowStyle="{StaticResource SharedDataGridRowStyle}"
              Style="{StaticResource SharedDataGridStyle}"
              VerticalScrollBarVisibility="Disabled">

              <DataGrid.Columns>
                <DataGridTextColumn
                  Width="230"
                  MinWidth="100"
                  Binding="{Binding Name}"
                  CanUserResize="True"
                  Header="Name"
                  IsReadOnly="True" />
                <DataGridTemplateColumn
                  Width="*"
                  MinWidth="100"
                  CanUserResize="True"
                  Header="Value">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding Value}" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                  <DataGridTemplateColumn.CellEditingTemplate>
                    <DataTemplate>
                      <TextBox IsEnabled="{Binding IsEditable}" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>

            <!--  Comment Section (Lyrics-style) -->
            <Grid Grid.Row="2" Margin="0,10,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource ControlAccentLightBrush}"
                Text="Comment" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource ControlAccentLightBrush}" />
            </Grid>
            <TextBox
              x:Name="CommentTextBox"
              Grid.Row="3"
              MaxHeight="150"
              Margin="0,0,0,10"
              Padding="8"
              AcceptsReturn="True"
              BorderThickness="0"
              FontSize="{DynamicResource FontSizeNormal}"
              IsReadOnly="True"
              LostFocus="CommentTextBox_LostFocus"
              MouseDoubleClick="CommentTextBox_MouseDoubleClick"
              PreviewKeyDown="CommentTextBox_PreviewKeyDown"
              PreviewMouseWheel="CommentTextBox_PreviewMouseWheel"
              Text="{Binding CommentItem.Value, UpdateSourceTrigger=PropertyChanged}"
              TextWrapping="Wrap"
              VerticalScrollBarVisibility="Auto">
              <TextBox.Style>
                <Style TargetType="TextBox">
                  <Setter Property="Cursor" Value="Hand" />
                  <Setter Property="Background" Value="Transparent" />
                  <Setter Property="Foreground" Value="{DynamicResource TitleBarForegroundBrush}" />
                  <Style.Triggers>
                    <Trigger Property="IsReadOnly" Value="False">
                      <Setter Property="Cursor" Value="IBeam" />
                      <Setter Property="Background" Value="#FFFFFF" />
                      <Setter Property="Foreground" Value="#000000" />
                      <Setter Property="BorderThickness" Value="2" />
                      <Setter Property="BorderBrush" Value="#0078D4" />
                    </Trigger>
                  </Style.Triggers>
                </Style>
              </TextBox.Style>
            </TextBox>

            <!--  Properties Title with Bar  -->
            <Grid Grid.Row="4" Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource SpectrumPeakBrush}"
                Text="Properties" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource SpectrumPeakBrush}" />
            </Grid>

            <DataGrid
              Grid.Row="5"
              Height="Auto"
              MinWidth="400"
              MaxHeight="Infinity"
              Margin="0,0,0,10"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              CanUserResizeRows="False"
              CellStyle="{StaticResource SharedDataGridCellStyle}"
              ColumnHeaderStyle="{StaticResource SharedDataGridColumnHeaderStyle}"
              HorizontalScrollBarVisibility="Disabled"
              ItemsSource="{Binding PropertyItems}"
              PreviewMouseWheel="DataGrid_PreviewMouseWheel"
              RowStyle="{StaticResource SharedDataGridRowStyle}"
              Style="{StaticResource SharedDataGridStyle}"
              VerticalScrollBarVisibility="Disabled">

              <DataGrid.Columns>
                <DataGridTextColumn
                  Width="230"
                  MinWidth="100"
                  Binding="{Binding Name}"
                  CanUserResize="True"
                  Header="Name"
                  IsReadOnly="True" />
                <DataGridTextColumn
                  Width="*"
                  MinWidth="100"
                  Binding="{Binding Value}"
                  CanUserResize="True"
                  Header="Value"
                  IsReadOnly="True" />
              </DataGrid.Columns>
            </DataGrid>

            <!--  ReplyGain Title with Bar  -->
            <Grid Grid.Row="6" Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource ControlAccentLightBrush}"
                Text="ReplayGain" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource ControlAccentLightBrush}" />
            </Grid>

            <DataGrid
              Grid.Row="7"
              Height="Auto"
              MinWidth="400"
              MaxHeight="Infinity"
              Margin="0,0,0,10"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              CanUserResizeRows="False"
              CellStyle="{StaticResource SharedDataGridCellStyle}"
              ColumnHeaderStyle="{StaticResource SharedDataGridColumnHeaderStyle}"
              HorizontalScrollBarVisibility="Disabled"
              ItemsSource="{Binding ReplayGainItems}"
              PreviewMouseWheel="DataGrid_PreviewMouseWheel"
              RowStyle="{StaticResource SharedDataGridRowStyle}"
              Style="{StaticResource SharedDataGridStyle}"
              VerticalScrollBarVisibility="Disabled">

              <DataGrid.Columns>
                <DataGridTextColumn
                  Width="230"
                  MinWidth="100"
                  Binding="{Binding Name}"
                  CanUserResize="True"
                  Header="Name"
                  IsReadOnly="True" />
                <DataGridTemplateColumn
                  Width="*"
                  MinWidth="100"
                  CanUserResize="True"
                  Header="Value">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <TextBlock IsEnabled="{Binding IsEditable}" Text="{Binding Value}" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                  <DataGridTemplateColumn.CellEditingTemplate>
                    <DataTemplate>
                      <TextBox IsEnabled="{Binding IsEditable}" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>

            <!--  Picture Title with Bar  -->
            <Grid Grid.Row="8" Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource SpectrumPeakBrush}"
                Text="Picture" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource SpectrumPeakBrush}" />
            </Grid>

            <!--  Picture section with two columns: ItemsControl and Image  -->
            <Grid Grid.Row="9" Margin="0,0,0,10">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="200" />
              </Grid.ColumnDefinitions>

              <!--  ItemsControl: Name/Value rows with scrollable textboxes  -->
              <ItemsControl
                Grid.Column="0"
                MinWidth="200"
                ItemsSource="{Binding PictureInfoItems}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid Margin="0,1">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="230" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>
                      <TextBlock
                        Grid.Column="0"
                        VerticalAlignment="Top"
                        Background="{DynamicResource TrackListColumnHeaderBackgroundBrush}"
                        FontSize="{DynamicResource FontSizeNormal}"
                        Foreground="{DynamicResource TrackListColumnHeaderForegroundBrush}"
                        Text="{Binding Name}" />
                      <TextBox
                        Grid.Column="1"
                        MaxHeight="90"
                        AcceptsReturn="True"
                        Background="{DynamicResource TrackListItemBackgroundBrush}"
                        BorderThickness="0"
                        FontSize="{DynamicResource FontSizeNormal}"
                        Foreground="{DynamicResource TrackListItemForegroundBrush}"
                        IsReadOnly="True"
                        Text="{Binding Value}"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto">
                        <TextBox.Style>
                          <Style TargetType="TextBox">
                            <Setter Property="Cursor" Value="Arrow" />
                            <Setter Property="Opacity" Value="1.0" />
                          </Style>
                        </TextBox.Style>
                      </TextBox>
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

              <!--  Album cover image  -->
              <Border
                Grid.Column="1"
                Margin="0,0,0,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Top">
                <Image
                  Width="180"
                  Height="180"
                  Source="{Binding AlbumCoverSource}"
                  Stretch="Uniform" />
              </Border>
            </Grid>

            <!--  Lyrics  -->
            <Grid Grid.Row="10" Margin="0,0,0,5">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <TextBlock
                VerticalAlignment="Center"
                FontSize="{DynamicResource FontSizeHeading}"
                FontWeight="Normal"
                Foreground="{DynamicResource SpectrumPeakBrush}"
                Text="Lyrics" />
              <Rectangle
                Grid.Column="1"
                Height="1.5"
                Margin="8,3,0,0"
                VerticalAlignment="Center"
                Fill="{DynamicResource SpectrumPeakBrush}" />
            </Grid>
            <TextBox
              x:Name="LyricsTextBox"
              Grid.Row="11"
              MaxHeight="300"
              Padding="8"
              AcceptsReturn="True"
              BorderThickness="0"
              FontSize="{DynamicResource FontSizeNormal}"
              IsReadOnly="True"
              LostFocus="LyricsTextBox_LostFocus"
              MouseDoubleClick="LyricsTextBox_MouseDoubleClick"
              PreviewKeyDown="LyricsTextBox_PreviewKeyDown"
              PreviewMouseWheel="LyricsTextBox_PreviewMouseWheel"
              Text="{Binding LyricsItem.Value, UpdateSourceTrigger=PropertyChanged}"
              TextWrapping="Wrap"
              VerticalScrollBarVisibility="Auto">
              <TextBox.Style>
                <Style TargetType="TextBox">
                  <Setter Property="Cursor" Value="Hand" />
                  <Setter Property="Background" Value="Transparent" />
                  <Setter Property="Foreground" Value="{DynamicResource TitleBarForegroundBrush}" />
                  <Style.Triggers>
                    <Trigger Property="IsReadOnly" Value="False">
                      <Setter Property="Cursor" Value="IBeam" />
                      <Setter Property="Background" Value="#FFFFFF" />
                      <Setter Property="Foreground" Value="#000000" />
                      <Setter Property="BorderThickness" Value="2" />
                      <Setter Property="BorderBrush" Value="#0078D4" />
                    </Trigger>
                  </Style.Triggers>
                </Style>
              </TextBox.Style>
            </TextBox>
          </Grid>
        </ScrollViewer>
      </DockPanel>
    </Grid>
  </Grid>

</Window>
